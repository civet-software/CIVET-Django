% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\usepackage[utf8]{inputenc}
\DeclareUnicodeCharacter{00A0}{\nobreakspace}
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{babel}
\usepackage{times}
\usepackage[Bjarne]{fncychap}
\usepackage{longtable}
\usepackage{sphinx}
\usepackage{multirow}

\addto\captionsenglish{\renewcommand{\figurename}{Fig. }}
\addto\captionsenglish{\renewcommand{\tablename}{Table }}
\floatname{literal-block}{Listing }



\title{CIVET Documentation}
\date{August 16, 2015}
\release{beta-0.7}
\author{Philip A. Schrodt\\Parus Analytics LLC\\Charlottesville, VA USA\\schrodt735@gmail.com}
\newcommand{\sphinxlogo}{\includegraphics{civet200.png}\par}
\renewcommand{\releasename}{Release}
\makeindex

\makeatletter
\def\PYG@reset{\let\PYG@it=\relax \let\PYG@bf=\relax%
    \let\PYG@ul=\relax \let\PYG@tc=\relax%
    \let\PYG@bc=\relax \let\PYG@ff=\relax}
\def\PYG@tok#1{\csname PYG@tok@#1\endcsname}
\def\PYG@toks#1+{\ifx\relax#1\empty\else%
    \PYG@tok{#1}\expandafter\PYG@toks\fi}
\def\PYG@do#1{\PYG@bc{\PYG@tc{\PYG@ul{%
    \PYG@it{\PYG@bf{\PYG@ff{#1}}}}}}}
\def\PYG#1#2{\PYG@reset\PYG@toks#1+\relax+\PYG@do{#2}}

\expandafter\def\csname PYG@tok@gd\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@gu\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@gt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PYG@tok@gs\endcsname{\let\PYG@bf=\textbf}
\expandafter\def\csname PYG@tok@gr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@cm\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@vg\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@m\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@mh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@cs\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\colorbox[rgb]{1.00,0.94,0.94}{\strut ##1}}}
\expandafter\def\csname PYG@tok@ge\endcsname{\let\PYG@it=\textit}
\expandafter\def\csname PYG@tok@vc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@il\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@go\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.20,0.20,0.20}{##1}}}
\expandafter\def\csname PYG@tok@cp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@gi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PYG@tok@gh\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@ni\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.84,0.33,0.22}{##1}}}
\expandafter\def\csname PYG@tok@nl\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.13,0.44}{##1}}}
\expandafter\def\csname PYG@tok@nn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@no\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.38,0.68,0.84}{##1}}}
\expandafter\def\csname PYG@tok@na\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@nb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@nc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@nd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.33,0.33,0.33}{##1}}}
\expandafter\def\csname PYG@tok@ne\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@nf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.49}{##1}}}
\expandafter\def\csname PYG@tok@si\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.44,0.63,0.82}{##1}}}
\expandafter\def\csname PYG@tok@s2\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@vi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@nt\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.45}{##1}}}
\expandafter\def\csname PYG@tok@nv\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@s1\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@gp\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@sh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@ow\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@sx\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@bp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@c1\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@kc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@c\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@mf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@err\endcsname{\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PYG@tok@mb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@ss\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.32,0.47,0.09}{##1}}}
\expandafter\def\csname PYG@tok@sr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.14,0.33,0.53}{##1}}}
\expandafter\def\csname PYG@tok@mo\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@kd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@mi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@kn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@o\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PYG@tok@kr\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@s\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@kp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@w\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PYG@tok@kt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.56,0.13,0.00}{##1}}}
\expandafter\def\csname PYG@tok@sc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@sb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@k\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@se\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@sd\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}

\def\PYGZbs{\char`\\}
\def\PYGZus{\char`\_}
\def\PYGZob{\char`\{}
\def\PYGZcb{\char`\}}
\def\PYGZca{\char`\^}
\def\PYGZam{\char`\&}
\def\PYGZlt{\char`\<}
\def\PYGZgt{\char`\>}
\def\PYGZsh{\char`\#}
\def\PYGZpc{\char`\%}
\def\PYGZdl{\char`\$}
\def\PYGZhy{\char`\-}
\def\PYGZsq{\char`\'}
\def\PYGZdq{\char`\"}
\def\PYGZti{\char`\~}
% for compatibility with earlier versions
\def\PYGZat{@}
\def\PYGZlb{[}
\def\PYGZrb{]}
\makeatother

\renewcommand\PYGZsq{\textquotesingle}

\begin{document}

\maketitle
\tableofcontents
\phantomsection\label{index::doc}\section*{Preface}
This is the documentation for the CIVET—Contentious Incident Variable Entry Template—data entry system. CIVET is being developed by the NSF-sponsored project titled “A Method for Leveraging Public Information Sources for Social Science Research” which is creating tools to improve the efficiency of data generation in the social sciences, with an initial focus on coding event data in the domain of contentious politics.

The system is deployed as a \href{https://www.djangoproject.com/start/overview/}{Django} application; it should be possible to get this working by installing Django on a local machine and copying the directory \code{djcivet\_site}.

We are very interested in feedback on this system, including any bugs
you encounter (please let us know what operating system (e.g. Windows,
OS-X) and browser (e.g. FireFox, Explorer, Chrome) you were using),
aspects of the manual that are unclear (and features that appear too
complex), and additional features that would be useful. Please send any
suggestions to \href{mailto:schrodt735@gmail.com}{schrodt735@gmail.com}.

\href{https://github.com/civet-software}{Link to} the software on GitHub
\section*{Acknowledgements}
The development of CIVET is funded by the U.S. National Science Foundation Office of Multidisciplinary Activities
in the Directorate for Social, Behavioral \& Economic Sciences, Award 1338470 and the \href{http://www.odum.unc.edu/odum/home2.jsp}{Odum Institute} at the University of North Carolina at Chapel Hill with additional assistance from \href{http://parusanalytics.com/}{Parus Analytics}. This documentation is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License; CIVET is open source and under the MIT license.




\chapter{Introduction}
\label{intro:introduction}\label{intro::doc}\label{intro:id1}
This is the documentation for the beta version of the
Civet \footnote{
\href{http://en.wikipedia.org/wiki/Civet}{http://en.wikipedia.org/wiki/Civet}
}—Contentious Incident Variable Entry Template—customizable
data entry system. Civet is being developed by the NSF-sponsored project
titled “A Method for Leveraging Public Information Sources for Social
Science Research” which is creating tools to improve the efficiency of
data generation in the social sciences. The project has an initial focus
on coding event data in the domain of contentious politics, but we
expect that these tools will be relevant in a number of data-generation
domains.

The core objective of Civet is to provide a reasonably simple—yes,
simple—set of commands that will allow a user to set up a web-based
coding environment without the need to master the likes of HTML, CSS and
Javascript. As currently implemented, the system is a rather ugly
prototype; it will also be evolving as we add additional elements.
Nonetheless, the system should now be useable for coding.

Civet is implemented in the widely-used and well documented
Python-based Django system \footnote{
An earlier prototype was implemented in the \code{Flask} framework: see
Appendix 4
} which is widely available on various
cloud platforms: a rather extended list of “Django-friendly” hosting
services can be found at
\begin{quote}

\href{https://code.djangoproject.com/wiki/DjangoFriendlyWebHosts}{https://code.djangoproject.com/wiki/DjangoFriendlyWebHosts}
\end{quote}

The complete Civet code is licensed as open source under the MIT
license and provided on GitHub at \href{https://github.com/civet-software}{https://github.com/civet-software} .

Civet currently has two modes:
\begin{description}
\item[{\textbf{Coding form template:}}] \leavevmode
This is a template-based for setting up a web-based coding form
which implements several of the common HTML data entry formats and
exports the resulting data as a tab-delimited text file. This is
fully functional and should be useable for small projects.

\item[{\textbf{Text annotation/extraction:}}] \leavevmode
This uses Civet “workspaces” which combine related texts, their
metadata, and the coding form. Workspaces allow for manual and
automated text annotation, then the ability to extract various types
of information into the fields of a coding form.

\end{description}


\section{Program Navigation Placeholders}
\label{intro:program-navigation-placeholders}
Civet is currently under development and not all of the options have
been fully implemented. If you see a page with a message of the form
\begin{quote}

\code{The option {[}something{]} has yet to be implemented. Use the back arrow in your browser to return to the previous screen.}
\end{quote}

you have encountered one of those options: as noted, just use the “Back”
option in your browser to return to the previous screen.


\section{Documentation}
\label{intro:documentation}
Documentation is maintained using the \href{http://http://sphinx-doc.org/}{Sphinx} system, which provides both an
\href{http://civet.parusanalytics.com/civetdocs/index.html}{on-line version} and a reasonably-well-formatted PDF version. There
are links to both of these compiled versions on the home page; the \code{.rst} source texts for the documentation are in the
directory \emph{djcivet\_site/docs}. That directory contains a Sphinx \emph{Makefile} so revisions can be compiled using the standard
command \code{make html latexpdf}.

The on-line documentation currently resides at the site \href{http://civet.parusanalytics.com/civetdocs/}{http://civet.parusanalytics.com/civetdocs/}; \footnote{
This is a bug, not a feature: there is presumably a way of accessing these at \emph{djcivet\_site/docs/\_build/html/}, or
somewhere else within the \emph{djcivet\_site/} directory
in a manner that has them correctly rendered, but I haven't figured it out yet. Fixes are welcome.
} a PDF version can
be downloaded by clicking the \code{Download PDF} link on the home page. \footnote{
This is handled in \code{views.download\_pdfdocs()}: it first looks for the PDF version of the documentation in
\emph{docs/\_build/latex/civetdoc.pdf}, which is where the most current version is likely to be located when the
documentation was produced using the \code{make latexpdf} command in the \emph{docs/} directory. If that isn't present,
it checks the \emph{/static/} directory: this can be used in deployments in order to avoid uploading  \emph{docs/}. If neither
is available, it gets the copy posted at \href{http://civet.parusanalytics.com/}{http://civet.parusanalytics.com/}, which may or may not correspond exactly to the
version being used depending on what modifications have been made. The command \code{make movepdf} will copy \emph{civetdoc.pdf} from
\emph{\_build/latex} to \emph{/static/}
}


\chapter{Installing CIVET}
\label{installing:installing-civet}\label{installing::doc}
To date we’ve only installed the system on Macintosh computers, though
the only difference between a Macintosh installation and other
installations should be the installation of the Django system.

On Macintoshes running OS-X 9 and 10, the required Python 2.7 comes
pre-installed. The \code{pip} installation program may also be
pre-installed—I’m having trouble determining this from the Web, and
forget whether I had to install it when I last upgraded—but if not,
install that.
\begin{enumerate}
\item {} 
In the Terminal, run \code{sudo pip install Django}: you will need
administrative access to do this.

\item {} 
Download the Civet system from
\href{https://github.com/civet-software/CIVET-Django}{https://github.com/civet-software/CIVET-Django}, unzip the folder and
put it wherever you would like

\item {} 
In the Terminal, change the directory so that you are in the folder
\emph{Django\_CIVET/djcivet\_site}

\item {} 
In the Terminal, enter \code{python manage.py runserver}

\item {} 
In a browser, enter the URL \href{http://127.0.0.1:8000/djciv\_data/}{http://127.0.0.1:8000/djciv\_data/}

\end{enumerate}

At this point you should see the Civet home screen
\begin{figure}[htbp]
\centering

\includegraphics[width=1.000\linewidth]{civethome.png}
\end{figure}


\section{Modifying the default installation}
\label{installing:modifying-the-default-installation}
Because CIVET is still in beta, the version on GitHub is the one being used for
development. To deploy the system for active coding, you will probably want
to make the following changes:
\begin{enumerate}
\item {} \begin{description}
\item[{In the file \emph{djcivet\_site/djcivet\_site/settings.py}, set \code{DEBUG = False}.}] \leavevmode
This will

It is appropriate to note the \href{https://docs.djangoproject.com/en/1.8/ref/settings/}{Django documentation advice}
on this:

\begin{Verbatim}[commandchars=\\\{\}]
Never deploy a site into production with DEBUG turned on.

Did you catch that? NEVER deploy a site into production with DEBUG turned on.
\end{Verbatim}

As the Django documentation discusses in detail, with \code{DEBUG = True} any
errors will generate an error page containing extensive internal detail
about your site. With \code{DEBUG = False}, the user just sees a \code{Page not found}
error.

\end{description}

\end{enumerate}


\chapter{Home Page Options}
\label{homepage:home-page-options}\label{homepage::doc}
The home page has the following links:
\begin{description}
\item[{\textbf{Read coding form:}}] \leavevmode
Civet reads a coding form template without using a workspace: this
is used if you want to use the web coding form without annotated
texts. This option can also be used when debugging coding forms.
Further instructions for the template-only mode are given in Section
{[}sec:template{]}.

\item[{\textbf{Read workspace:}}] \leavevmode
Civet reads a set of text collections and their associated coding
form from a zipped file: this mode allows for text annotation and
extraction and is described in more detail in Section
{[}sec:workspace{]}, {[}sec:annotate{]} and {[}sec:coding{]}.

\item[{\textbf{Manage workspace:}}] \leavevmode
This links to various utilities that operate on workspace files
(Section {[}sec:workspace{]}) including downloading the coded data as a
tab-delimited file, editing the meta-data, and adding comments to
the file. {[}Beta 0.7: only the data download is implemented{]}

\item[{\textbf{Set preferences:}}] \leavevmode
This goes to a page where various program preferences can be set
manually. {[}Beta 0.7: not currently implemented{]}

\end{description}

\textbf{Documentation}
\begin{quote}
\begin{description}
\item[{\textbf{On-line manual}}] \leavevmode
Links to an HTML version of the documentation

\item[{\textbf{Download PDF}}] \leavevmode
This downloads a PDF file with the documentation.

\end{description}
\end{quote}


\section{File selection}
\label{homepage:file-selection}
The first three modes go to a file selection screen.
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{fileselect.png}
\caption{Civet file selection screen}\end{figure}

This provides the following options:
\begin{description}
\item[{Choose file:}] \leavevmode
Select a file containing a coding form template or workspace, then
read this into the system by clicking the \code{Read file} button.

\item[{Coder:}] \leavevmode
Any text entered here—typically a coder name or ID—will be included
as metadata with any annotations or cases coded. This field is
optional.

\item[{Demo file:}] \leavevmode
Read the simple demonstration files built into the system. \footnote{
These files are named \code{CIVET.demo.template.txt} and
\code{CIVET.extract.demo.zip} in the directory
\code{djcivet\_site/djciv\_data/static/djciv\_data/} and can be modified
there.
}

\item[{Download demonstration file:}] \leavevmode
This downloads a template or workspace demonstration file, which can
be used as an example.

\end{description}


\chapter{CIVET Coding Form Templates}
\label{forms:sec-forms}\label{forms:civet-coding-form-templates}\label{forms::doc}
A CIVET template file specifies the individual components of the form:
these are the familiar components from web forms but the syntax used to
specify them is simpler than what you will find in HTML.

CIVET is simply adding these controls to an HTML \code{\textless{}form\textgreater{}} and, as with
all things HTML, most of the placement of the fields is handled by the
browser. \footnote{
Writing in HTML5 and CSS, one can actually exercise a very fine
degree of control over the placement, but if you are comfortable with
that sort of code, you presumably aren’t using CIVET in the first
place. That said, you can see the HTML generated by CIVET by using
the \emph{View source} option in your browser, then save it as a file
using \emph{Save Page As...} and that could provide a starting point for
creating prettier code.
} CIVET provides some limited formatting through the
insertion of text and line breaks, and with some experimenting you
should be able to keep the form from being too ugly.

The template file should be a simple text file—most systems are happier
if this ends in the suffix \code{.txt}—similar to that used in an \emph{R}
or \emph{Stata} script (that is, not a formatted file such as that
produced by \emph{MS-Word}). Appendix 1 gives an example of a template
file, and the code for this can also be downloaded from a link in the
program.


\section{Simple Template-Based Data Entry Form}
\label{forms:simple-template-based-data-entry-form}
The basic data entry form just uses the presumably familiar standard
HTML data entry fields and should be self-explanatory.

To save a set of coded fields, click one of the buttons which follow the
title \code{Options after saving:}
\begin{description}
\item[{Code another case:}] \leavevmode
Save, then return to the same form

\item[{Download data:}] \leavevmode
Save, then download data as a tab-delimited text file

\end{description}

The \code{Download CIVET data} page  provides a
text box for a file name, and the \code{Download file} button downloads the
coded data. Use the \emph{Start new data file} link to re-start the coding
and the \emph{Continue coding with this file} link to continue adding to the
existing records.
\begin{itemize}
\item {} 
The .txt file is tab-delimited and contains the variable names in the
first line.

\item {} 
If the file name does not end in “.txt,” this suffix will be added.

\end{itemize}
\begin{figure}[htbp]
\centering

\includegraphics{download.png}
\end{figure}


\section{Command formats}
\label{forms:command-formats}
Commands generally have the following format

\begin{Verbatim}[commandchars=\\\{\}]
command: entry\PYGZhy{}title [var\PYGZhy{}name] options
comma\PYGZhy{}delimited list
\end{Verbatim}

Commands vary in how many of these components they have, but all follow
this general pattern.

Each command ends with a blank line (or, if you prefer, the commands are
separated by blank lines.)

Commands can also be cancelled by adding a “-” in front of the command:
this will cancel the entire command, that is, all of the lines
associated with the command, not just the first line. For visual
symmetry, a “+” in front of the command “activates” it, though the
command will also be active without the plus.

“\#” denotes a comment: anything following a “\#” is ignored, so lines
beginning with “\#” are completely ignored.


\subsection{Items in template specification}
\label{forms:items-in-template-specification}
The commands involve one or more of the following items:
\begin{description}
\item[{entry-title}] \leavevmode
This is the title of data entry field. If this ends with \code{/} a
line-break (\code{\textless{}br\textgreater{}}) is inserted after the text. The titles are
escaped: at present the characters \textless{}, \textgreater{}and the single and double
quotes are replaced with the equivalent HTML entities
\code{\&lt;, \&gt; \&quot;} and \code{\&rsquo;}. \footnote{
In the current implementation, named HTML entities such as \code{\&copy;}
and \code{\&euro;} can be included and should produce the correct
character. At present numbered entities such as \code{\&\#91;}—the HTML
equivalent of ’{]}’—do not work since the \# is interpreted as a comment
delimiter: depending on whether there is demand for this feature, the
system could provide a way around this.
} The \textbf{entry-title}
field cannot contain the characters “{[}” or “{]}”—if these are present
they will be interpreted as bounding the \textbf{var-name} field—but the
escaped versions “\textbackslash{}{[}” and “\textbackslash{}{]}” are allowed.

\item[{var-name}] \leavevmode
The text of the variable name for this field; this will be used in
the first line of the \code{.csv} output file

\item[{comma-delimited-option-list}] \leavevmode
A list of the items that can be selected, separated by commas. A
‘*’ at the beginning of the item means that it will be initially
selected.

\item[{comma-delimited-var-name-list}] \leavevmode
A list of items which appear in \textbf{var-name} fields, separated by
commas.

\item[{page-text}] \leavevmode
Any text

\item[{number}] \leavevmode
An integer

\end{description}


\subsection{Errors in template commands}
\label{forms:errors-in-template-commands}
There is a fair amount of error trapping as the commands are processed;
any problems will reported on a web page. Generally the system will
stop after it has encountered the first error rather than reporting
all of the errors in the file.


\section{Templates: Specifying variables}
\label{forms:templates-specifying-variables}

\subsection{Specifying variables to save}
\label{forms:specifying-variables-to-save}
This command gives the variables that will be saved; these can be in any
order but each of these must correspond to a \code{var-name} somewhere in
the form, or are one of the special variables discussed below. A
tab-delimited version of this list will be the first line of the output
file. The command can occur anywhere in the file.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{save:}
\item[] comma-delimited-var-name-list
\end{DUlineblock}
\end{quote}

If the variable name has brackets following it, the \emph{value} of the
variable rather than the literal text will be written when the data are
written to a tab-delimited file: the value is the string in brackets
\code{{[}…{]}} in the annotated coding mode. If there is a variable name inside
the brackets, that will be used as the column name for the values;
otherwise the regular name will be used: this allows both the literal
text and the value to be saved, as in the third example below. If
\code{save} specifies a value output and not is found, a missing value will
be used.

\textbf{Example:}
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \code{save: worldregion, eyewit, groupname, comments}
\item[] \code{save: worldregion {[}regioncode{]}, eyewit, groupname{[}{]}, comments}
\item[] \code{save: worldregion, eyewit, groupname, groupname {[}groupcode{]}, comments}
\end{DUlineblock}
\end{quote}


\subsection{constant}
\label{forms:constant}
Sets the value of a variable to a constant; this can be used in a
\code{save:}
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{constant:} page-text {[}varname{]}
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{constant: Data set 0.2 {[}data\_id{]}}
\end{quote}


\subsection{filename}
\label{forms:filename}
Sets the default file name for the downloads: this can be changed before
downloading. {[}Beta 0.7: Not yet implemented{]}
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{filename:} page-text
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{filename: our\_wonderful\_data.csv}
\end{quote}


\subsection{Special variables}
\label{forms:special-variables}\begin{description}
\item[{\_coder\_}] \leavevmode
: Text entered in the \emph{CIVET template selection} page

\item[{\_date\_}] \leavevmode
: Current date. this is currently in the form DD-mmm-YYYY but later
versions of the system will allow other formats

\item[{\_time\_}] \leavevmode
: Current time in hh:mm:ss format

\end{description}


\section{Templates: Data Entry Fields}
\label{forms:templates-data-entry-fields}

\subsection{Checkbox}
\label{forms:checkbox}
A simple binary check-box. The value of the variable will be first item
in the list when the box is not checked; the second item when the box is
checked. The * notation on the second item can be used to specify
whether or not the box is initially checked.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{select:} entry-title {[}var-name{]}
\item[] comma-delimited-option-list
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{select: Eyewitness report? {[}eyewit{]} no,*yes}
\end{quote}


\subsection{Select from pull-down menu}
\label{forms:select-from-pull-down-menu}
Pull-down menus—which are called a “select” in HTML—are specified with
the syntax
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{select:} entry-title {[}var-name{]}
\item[] comma-delimited-option-list
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{select: Region {[}worldregion{]} North America, South America, Europe, *Africa, Middle East, Asia}
\end{quote}


\subsection{Radio buttons}
\label{forms:radio-buttons}
A series of radio buttons are specified with the syntax
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{radio:} entry-title {[}var-name{]}
\item[] comma-delimited-option-list
\end{DUlineblock}
\end{quote}

The entry \code{/} in the option list causes a line-break (\code{\textless{}br\textgreater{}}) to be
inserted

\textbf{Example:}
\begin{quote}

\code{radio: Region/ {[}worldregion{]} North America, South America, Europe, *Africa, /,Middle East, Asia}
\end{quote}


\subsection{Enter single line of text}
\label{forms:enter-single-line-of-text}
This creates a box for a single line of text (HTML {}`{}` type=text{}`{}`). The
\code{width = number} is optional and specifies the size of the text entry
box in characters: the default is \code{width = 32}
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{textline:} entry-title {[}var-name{]} width = number
\item[] initial-text
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{textline: Name of group {[}groupname{]} \textless{}enter name\textgreater{}}
\end{quote}


\subsection{Extract single line from annotated text}
\label{forms:extract-single-line-from-annotated-text}
This creates a box for a single line of text (HTML {}`{}` type=text{}`{}`) that
will interact with annotated text; in addition information can be
manually entered or cut-and-pasted into this box. If this command is
used in a form that does not have associated annotated text, it behaves
the same as \code{textline} and the \code{class} information is ignored.

The \code{class=class-name} is required and specifies the name of the
annotation class that the text-entry box is connected with; a class can
be associated with multiple text-entry boxes. There are three standard
classes:
\begin{itemize}
\item {} 
\code{nament}: named-enties, which are determined by capitalization

\item {} 
\code{num}: numbers

\item {} 
\code{date}: dates

\end{itemize}

The \code{width = number} is optional and specifies the size of the text
entry box in characters: the default is \code{width = 32}
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{textclass:} entry-title {[}var-name{]} class=class-name
width=number
\item[] initial-text
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{textclass: Name of city {[}cityname{]} class=nament \textless{}enter city\textgreater{}}
\end{quote}


\subsection{Enter multiple lines of text}
\label{forms:enter-multiple-lines-of-text}
This corresponds to an HTML “TEXTAREA” object. The
\code{rows = number cols = number} is optional and specifies the size of
the text entry box in characters: the default is \code{rows = 4 cols = 80}
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{textarea:} entry-title {[}var-name{]} rows = number cols = number
\item[] initial-text
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{textarea: Comments {[}comments{]} rows = 2 cols = 64 – put any additional comments here –}
\end{quote}


\section{Templates: Additional Web Page Formatting}
\label{forms:templates-additional-web-page-formatting}

\subsection{Set page title}
\label{forms:set-page-title}
Sets the title of the web page: that is, the HTML{}`{}`\textless{}title\textgreater{}...\textless{}/title\textgreater{}{}`{}`
section of the header.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{title:} page-text
\end{DUlineblock}
\end{quote}

\textbf{Example:}
\begin{quote}

\code{title: CIVET-based coding form}
\end{quote}


\subsection{Insert text}
\label{forms:insert-text}
Adds text to the form: the various options follow the usual HTML
formats. In interests of simplicity, text is “escaped” so that special
characters are not interpreted as HTML: note that this means that
in-line mark-up such as \code{\textless{}i\textgreater{}}, \code{\textless{}b\textgreater{}} and \code{\textless{}tt\textgreater{}} will not work,
so if you need this activate and use the \code{html:} command. Also keep in
mind that these commands need to be separated by a blank line.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{h1:} page-text
\item[] \textbf{h2:} page-text
\item[] \textbf{h3:} page-text
\item[] \textbf{h4:} page-text
\item[] \textbf{p:} page-text
\end{DUlineblock}
\end{quote}

\textbf{Example:}

\begin{Verbatim}[commandchars=\\\{\}]
h1: Primary data set coding form

p:Please enter data in the fields below, and be really, really careful!
\end{Verbatim}

The simple command

\begin{Verbatim}[commandchars=\\\{\}]
p:
\end{Verbatim}

is useful for putting some space between form elements.


\subsection{Insert HTML}
\label{forms:insert-html}
{[}This command may or may not be included in the operational version of
the system, as it provides some opportunities for mischief. Stay tuned.
It is in the code but currently deactivated; if you are installing your
own version of the system, it can be activated by changing a single
character in the source code.{]}

Adds arbitrary HTML code without escaping.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{html:} page-text
\end{DUlineblock}
\end{quote}


\subsection{Insert a line break}
\label{forms:insert-a-line-break}
Adds a new line in the form
\begin{quote}

\textbf{newline:}
\end{quote}


\chapter{CIVET Workspaces}
\label{workspaces:civet-workspaces}\label{workspaces::doc}

\bigskip\hrule{}\bigskip


CIVET is part of a projected collection of open-source programs designed
to work with very large sets of small text files: in the domain of
contentious politics these are usually news articles but the issue of
managing very large databases of small texts extends well beyond this
application. For example, projects analyzing texts from legislative
debates, legislation, campaign web sites and blogs all have much the
same character when they are studied at a large scale.

In the CIVET system, files containing sets of individual stories are
called “collections”: these are typically multiple related news
stories—“texts”—from which one or more data records—“cases”—are coded.
These are stored in a YAML format \footnote{
\href{https://en.wikipedia.org/wiki/YAML}{https://en.wikipedia.org/wiki/YAML}
} which is a structured
human-readable text file containing a number of data fields; the details
of this are given in Appendix 2.

Sets of text collections are grouped into “workspaces” that also contain
an associated coding form and, optionally, other information such as
user-specified categories that will be used in automatic annotation. The
template file begins with the string “\code{form.}” and uses the category
and template commands described in Section {[}sec:form{]}. Workspaces are
compressed (\code{.zip}) directories (folders).

In the current configuration of the system, workspace files are uploaded
to the system, annotated and/or coded, then downloaded when a session is
completed: no data remain on the machine where the CIVET system is
running. In a future version, we expect to have an option for persistent
data that could be used on a secure server, as well as options for
reading these files from a server.

The workspace will generally \emph{not} be downloaded to the same place it
was originally: as a standard HTML security feature, the system does not
retain any information about where it obtained a file. Instead, it will
be downloaded to wherever your system downloads file: for example on the
Macintosh this is a folder named \code{Downloads}. \footnote{
If you read the workspace from the same directory where it will
eventually be downloaded, the behavior presumably depends on the
operating system: in the case of the Macintosh both the downloaded
file and the decompressed versions get a suffix added. E.g. if the
original workspace folder is named \code{test123} with the compressed
version \code{test123.zip}, the system assigns the downloaded version
the name \code{test123 (1).zip} which decompressed to a folder named
\code{test123 (1)}. We are leaving the task of insuring that the
original file is not over-written to the operating system and
whatever other utilities you might be using to manage workspaces.
} If you wish to
replace the original workspace file, this will need to be done manually
or with a script operating locally.

There is some limited error checking as the workspace is processed. If
errors are found you will get a screen similar to the figure
below listing the errors, which must be corrected before the
workspace can be used.
\begin{figure}[htbp]
\centering

\includegraphics{workspace_errors.png}
\end{figure}

Like error messages in all programs, these are self-explanatory \footnote{
Hahaha…just a little programmer joke…
}
though in general errors will occur either when you are processing a
workspace for the first time or if you have manually edited it outside
of the CIVET system: once a workspace has been successfully read by
CIVET the program should not introduce any errors that would be caught
at this point. \footnote{
For example, the error in the variable values string in Figure
{[}fig:workerrors{]} occurs because of the substring
\code{’whois’=’Case1-whois’,} which should actually be
\code{’whois’:’Case1-whois’,} but that ‘\code{=}’ could only have been
introduced through external editing.
}

The program is sensitive to file names:
\begin{itemize}
\item {} 
Any file ending with \code{.yml} is assumed to be a CIVET -formatted
collections file

\item {} 
There should be one and only file beginning with the string
\code{form.}: this specifies the coding form for the workspace

\item {} 
Any file beginning with \code{codes.} is assumed to be a
{\hyperref[workspaces:sec-categories]{\emph{\DUspan{}{category vocabulary list}}}}. In the file name,
``codes.'' must be followed by a
\code{category} name then a period; the remainder of a ``codes'' file
name can be anything, though typically it will end in \code{.txt}.

\item {} 
Any file ending with \code{.ini} is assumed to be a configuration file
{[}Beta 0.7: Not yet implemented{]}

\end{itemize}

Except for these restrictions, the directory can contain additional
files of any kind: these will be preserved when the file is downloaded.
A workspace file cannot contain subdirectories.

Additional notes on workspaces:
\begin{itemize}
\item {} 
So long as the YAML formatting is preserved—which should be fairly
straightforward—the system is indifferent as to whether editing is
done inside or outside of CIVET .

\item {} 
If the \code{form} file is missing or contains errors, the system will
display the errors it found, then return to the data selection page.

\item {} 
If you are manually editing the variable values in the \code{cases}
section, any single quotes (\code{’}) must be “escaped”; that is,
replaced with \code{\textbackslash{}’}. This will be done automatically when cases are
generated from inside the program.

\end{itemize}


\section{Workspace Management}
\label{workspaces:workspace-management}\label{workspaces:sec-management}
The \code{Manage workspace} link on the home page will take you first to a
workspace selection page, and then to the page shown below. In Beta 0.7, only the
\code{Export data in tab-delimited format/Use save-variable list in the template}
is implemented: this will download any coded cases found in the
workspace.
\begin{figure}[htbp]
\centering

\includegraphics{manage.png}
\end{figure}


\section{User-specified annotation vocabulary using \textbf{category}}
\label{workspaces:sec-categories}\label{workspaces:user-specified-annotation-vocabulary-using-category}
The \code{category} command is used to set up special categories of words
that will be color-coded and can be associated with text-extraction
fields. The annotation can either be done automatically or by manually
selecting the text and using the \code{Style} pull-down menu in the
annotation editor.
\begin{quote}

\begin{DUlineblock}{0em}
\item[] \textbf{category:} category-name {[}color{]}
\item[] comma-delimited-phrase/code-list or file-name
\end{DUlineblock}
\end{quote}

The \code{category-name} must be unique and cannot be one of the standard
categories \code{nament, num} or \code{date}. The program currently
accommodates up to 99 categories. \footnote{\begin{description}
\item[{If you need more, this can be changed by allowing more digits in}] \leavevmode
the \code{\{:02d\}} format in the code
\begin{quote}

{}`{}` UserCategories{[}newcat{]}.append(’termst\{:02d\}’.format(len(UserCategories))){}`{}`
\end{quote}

\end{description}

in \code{CIVET\_template.make\_category()}
}

\begin{DUlineblock}{0em}
\item[] \code{color} can be any of the 140 named HTML5 colors, \footnote{
See \href{http://www.w3schools.com/html/html}{http://www.w3schools.com/html/html} colornames.asp
} a six-digit
hexadecimal RGB color (e.g. \code{6A5ACD} corresponds to the named color
“SlateBlue”; the hex notation provides a presumably sufficient choice
of 16,777,216 colors), or a two-digit color from the CIVET
palette. \footnote{
This palette was assembled in a very ad hoc manner, is not
color-blind-friendly, and we would be delighted to substitute
something better. The list is set as \code{CIV\_template.CatColorList}
} The palette, shown below, can be
accessed by entering the address
\end{DUlineblock}
\begin{quote}

\href{http://127.0.0.1:8000/djciv\_data/make\_color\_list}{http://127.0.0.1:8000/djciv\_data/make\_color\_list}
\end{quote}

\begin{DUlineblock}{0em}
\item[] while the program is running on a dedicated machine. If \code{{[}color{]}} is
empty—that is, \code{{[}{]}}—the system uses a color from the standard list
in the listed order.
\end{DUlineblock}
\begin{figure}[htbp]
\centering

\includegraphics{defaultcolors.png}
\end{figure}

The program will find capitalized versions of the words in the list—in
the example below, both ``killed'' and ``Killed'' will match—but not
all-capitalized versions: ``KILLED'' would not be matched. A word or
phrase can only be in a a single category: putting one in multiple
categories will not cause an error, but only the first category
evaluated—generally this will occur in the order the categories were
entered—will be marked. Words and phrases within a category are
evaluated in the order they are listed—see the example in the chapter on annotation—
which can be used to establish precedent when words or
phrases overlap. At present the program does not allow partial matches,
though a facility for this may be added in the future. \footnote{
\begin{DUlineblock}{0em}
\item[] If you want it now, delete the test
\item[] “\code{if endx == idx+len(st):}” in
\code{CIVET\_utilities.do\_string\_markup()}.
\end{DUlineblock}
}

The comma-delimited-phrase/code-list can have codes assigned to each of
the phrases: these occur in brackets following the phrase and are added
to the text during automated markup. The codes can be any character
string. Either the phrase or the code or both can be specified in the
output. If some of the phrases in the list have codes and others do not,
the blank codes will be assigned a null (or, optionally, missing)
string.

The vocabulary list can also be read from a file in the workspace. The
file name must begin with \code{codes.+category-name.}; the remainder of
the file name can be anything. \footnote{
The period following the category-name is required!: the file name
\code{codes.weapons\_mnsa\_list.txt} would not be recognized as a valid
\code{codes.} file. Or rather it would be interpreted as applying to a
category \code{weapons\_mnsa\_list}, not the category \code{weapons}.
} This be a text file with one phrase
per line and the code in brackets; a line beginning with \# is treated as
a comment.

\textbf{Example:}
\begin{quote}

\code{category:action {[}red{]} killed {[}1{]}, wounded {[}2{]}, shot and killed {[}1{]}, bombed {[}3{]}, clashed {[}3{]}}

\code{category:people {[}Brown{]} civilians, workers, authorities, troops, soldiers, rebels, people, group}

\code{category:nationstate {[}Gold{]} codes.nationstate.txt}

\code{category:weapons {[}Olive{]} codes.weapons.mnsa.weaponslist\_150724.txt}
\end{quote}


\chapter{Annotation and Editing Collections}
\label{annotation::doc}\label{annotation:annotation-and-editing-collections}
The annotation and editing page for workspace collections implements a
minimal version \footnote{
that is, the version of \code{ckeditor} deliberately uses only a very
small set of the features that are available for the editor: if you
want to customize this, additional features can easily be added.
} of the Javascript \code{ckeditor} which allows the
texts to be edited and annotated. Editing works as you would expect,
including cut/copy/paste options.

Annotation is handled with the \code{Styles} drop-down menu in the window
toolbar which should show both
the standard CIVET categories—named-entity, number and date— and any
user-specified categories. To annotate, just select the text you want to
annotate and then select the annotation to apply.
\begin{figure}[htbp]
\centering

\includegraphics{ckedit_menu.png}
\end{figure}
\begin{figure}[htbp]
\centering

\includegraphics{style_options.png}
\end{figure}

The following options are available on this screen

Annotate the collection:
\begin{quote}

This applies the automated markup system which currently annotates the following
categories of words and phrases:
\begin{description}
\item[{Named-entities:}] \leavevmode
This is based on capitalization; consecutive capitalized words
are combined.

\item[{Numbers:}] \leavevmode
Digits and numerical words and phrases such as “one” and
“two-hundred.”

\item[{User-specified categories:}] \leavevmode
See the discussion of {\hyperref[workspaces:sec-categories]{\emph{\DUspan{}{categories}}}}

\end{description}
\end{quote}

Save edits and select new collection:
\begin{quote}

This saves whatever annotation has been done to the internal
database \footnote{
That is, the data is saved on the machine where CIVET is running; it
is not saved on your local machine until the workspace is downloaded.
} and returns to the collection selection screen :
this option would be used if you are only annotating text rather
than coding them. Annotations are saved in the \code{textmkup} field
of the YAML file along with the date of the annotating and the
coder ID.
\end{quote}

Save edits and code the collection:
\begin{quote}

This saves whatever annotation has been done to the internal
database and goes to the coding and text extraction page
\end{quote}

Discard edits and select new collection:
\begin{quote}

This discards the edits and returns to the collection selection screen.
\end{quote}

Download workspace and return to home screen:
\begin{quote}

This downloads the current workspace without doing any coding.
\end{quote}


\section{Comments on annotation and editing}
\label{annotation:comments-on-annotation-and-editing}\begin{enumerate}
\item {} 
Associated codes in brackets following a term can be edited: when
writing variable values, the system will simply be looking for a
value in a bracket.

\item {} 
A word or phrase can be annotated only once. \footnote{
It would be possible to modify the system to allow for phrases to be
in multiple categories, but at present this seems like a low
priority; such a feature may or may not be included in future
versions.
} The user-specified
\code{category} words are annotated before the general named-entity, so
if a named entity occurs in a \code{category}, that will take
precedence. Similarly, any numbers that occur in a \code{category}
phrase will be part of the phrase, not separately marked as numbers.

\item {} 
Words and phrases in \code{category} lists are evaluated in the order
they are listed, which can be used to establish precedence.

Consider the sentence

\end{enumerate}
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{annotation0.png}
\caption{The category listing:}{\small 
\begin{Verbatim}[commandchars=\\\{\}]
category:action [red]
shot and killed [4], killed [1], wounded [2], bombed [3]
\end{Verbatim}

would result in the annotation
}\end{figure}
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{annotation1.png}
\caption{whereas category listing:}{\small 
\begin{Verbatim}[commandchars=\\\{\}]
category:action [red]
killed [1], shot and killed [4], wounded [2], bombed [3]]
\end{Verbatim}

would result in the annotation
}\end{figure}
\begin{figure}[htbp]
\centering
\capstart

\includegraphics{annotation2.png}
\caption{because the “killed” part of the phrase “shot and killed” has
already been annotated, and the remainder does not fit any of the
patterns.}\end{figure}
\begin{enumerate}
\setcounter{enumi}{3}
\item {} 
CIVET does not identify a capitalized word as a named-entity if it occurs as a single
word and is in the list of common “stop words” in the file
\begin{quote}

\code{djcivet\_site/djciv\_data/static/djciv\_data/CIVET.stopwords.txt}
\end{quote}

In other words, “The” will be included as part of a named-entity in the phrase
“The New York Times” but not in the phrase “The village was…”

\item {} 
Words referring to numbers such as “one”, “ten” and “fifty” have the corresponding
numerical value added in brackets following the number; these phrase and their
associated values are obtained from the file

\code{djcivet\_site/djciv\_data/static/djciv\_data/CIVET.numberwords.txt} \footnote{
Looking for a little programming exercise?: This needs more
development in at least three ways. First, generate all of the
standard English equivalents, e.g. “eighty-five”, since these follow
a simple set of rules. Second, and perhaps more important, allow the
user to specify the values for common approximations such as
“several,”, “many” and “dozens.” The second can be done by just
editing the file \code{CIVET.numberwords.txt}, though generally we don’t
want the user to have to figure out how to do that. Finally, there
should probably be some error checking to make sure the value in
brackets is actually a number: CIVET will just copy the value in
brackets without trying to convert it, but non-numbers will
presumably create issues further down the processing pipeline.
}

This file only contains the most commonly-encountered phrases; bracketed values can be added manually as well.

\end{enumerate}
\begin{enumerate}
\setcounter{enumi}{4}
\item {} 
At present, CIVET does not recognize leading punctuation—typically
quotes—and will not automatically mark named entities or numbers
beginning with this: this is on the list of changes for the future.
It does handle most trailing punctuation. In named entities, the
lower-case prefixes “al-”, “bin-” and “ibn-” are recognized as
part of a name. \footnote{
This list can be extended in the regular expression \code{pat1} in
\code{civet\_utilities.do\_NE\_markup()}.
}

\end{enumerate}


\chapter{Coding and Text Extraction}
\label{extraction::doc}\label{extraction:coding-and-text-extraction}
The CIVET coding form screen in the demonstration version is shown below. \footnote{
The form displayed is specified in the file

\code{djcivet\_site/djciv\_data/static/djciv\_data/CIVET.demo.coder.template.txt}

and can be modified if you want to experiment.
}
\begin{figure}[htbp]
\centering

\includegraphics[width=0.800\linewidth]{civetcoder.png}
\end{figure}

The general operation of the coder/extractor is described below:
\begin{enumerate}
\item {} 
Clicking a text entry boxes associated with an annotation category
will highlight the relevant words in text: In the demonstration
version these are
\begin{description}
\item[{Location:}] \leavevmode
named-entities

\item[{Maximal injuries:}] \leavevmode
actions

\end{description}

The ‘tab’ key cycles between the coding fields, or an option can be
selected using the mouse.

\item {} 
When an annotated category field is active, all of the words and
phrases in the text for that category are changed to red, with the
first word highlighted using a green background. The arrow keys can
be used to move the highlighted text into the field. These operate as
follows:
\begin{description}
\item[{Right arrow:}] \leavevmode
Highlight the next text in the category \footnote{
Occasionally you will need to hit the key twice when changing
directions: this is a bug, not a feature, and may be corrected at
some point. Usually it works the first time. If you would like to try
to fix this, look at the Javascript in the file \code{civet\_coder.html}
}

\item[{Left arrow:}] \leavevmode
Highlight the previous text in the category

\item[{Down arrow:}] \leavevmode
\emph{Replace} the contents of the field with either the currently
selected text—this is effectively a single-key shortcut for a
copy-and-paste—or, if no text is selected, the highlighted
text. \footnote{
If you are tabbing between fields and extracting the first
highlighted text, you will need to hit down arrow twice: also a bug
rather than a feature.
}

\item[{Up arrow:}] \leavevmode
\emph{Append} the contents of the field with either the currently
selected text or, if no text is selected, the highlighted text

\end{description}

\item {} 
Copy-and-paste from the text to the data fields work as you would
expect; text can also be entered manually.

\item {} 
To save a set of coded fields, click one of the buttons along the
bottom. At present, all three buttons save; later versions add
``cancel“ and ``reset” options. The options are:
\begin{description}
\item[{Continue coding this collection:}] \leavevmode
Save the data internally, then return to the same text to code
additional cases.

\item[{Code next collection:}] \leavevmode
Save the data internally, then select the next collection in the
workspace and go to the annotation screen. \footnote{
Beta 0.7: In the final version of the program, there will be an
option for going to either the annotation or coding screen; the
annotation screen will also have a “Next” button.
}

\item[{Select new collection:}] \leavevmode
Save the data internally, then select a new collection

\item[{Download workspace and return to home screen:}] \leavevmode
This downloads the workspace with the coded cases to the local
machine. The {\hyperref[workspaces:sec-management]{\emph{\DUspan{}{Manage workspace}}}} facility  can then be used to download any coded cases.

\end{description}

\end{enumerate}


\chapter{Projected Features}
\label{future::doc}\label{future:projected-features}
CIVET is part of a projected system designed for managing
tens-of-thousands, or even millions, of small text files. The transition
in the past three decades from paper-based to electronic sources has
dramatically increased the amount of information that can potentially be
coded, but results in a “drinking from a fire hose” problem where a huge
number of false positives must be managed because typically only a very
small percentage of the texts obtained for a project actually contain
unique codeable events: yields of 1\% to 3\% are not uncommon. There is
very little existing software designed to deal with this situation,
since the texts are too large to be treated as nominal variables in a
statistical package and too numerous to be treated as documents in a
word processor. Consequently large projects typically write customized
systems in a language such as perl or Python, but these require
programming skills which are not always easily available in the social
science community.

We are planning to extend the CIVET workspace format to become the basis
of an integrated series of well-documented and user-friendly utilities
for dealing with this situation. All of the software will be open-source
under the MIT license, and made available to the community on GitHub.
These utilities will provide at least the following capabilities:
\begin{itemize}
\item {} 
Near-duplicate detection which will collect articles which appear to
be dealing with the same incident

\item {} 
Extraction programs for converting common formats such as
Lexis-Nexis, Factiva and GigaWord to the CIVET document format.

\item {} 
Filtering and classification of texts based on one or more of the
following methods
\begin{description}
\item[{Pattern-based:}] \leavevmode
These will include regular expressions and boolean phrases with
proximity measures

\item[{Semi-supervised learning:}] \leavevmode
The system will construct one or more machine-learning models
(for example support vector machines) to determine whether an
article is relevant based on a set of positive and negative
examples provided by the user

\item[{Action-based:}] \leavevmode
These will use either the open source TABARI or PETRARCH
political event coders to determine the type of activity being
described

\item[{Actor-based:}] \leavevmode
These will use a set of standard lists maintained on a common
server of political actors such as nation-states, international
organizations and militarized non-state actors

\item[{Geographical:}] \leavevmode
These will use systems such as the open-source Mordecai location
resolution system developed by Caerus Analytics.

\end{description}

\item {} 
Workflow management software for allocating and tracking the coding
of incidents in large coding teams; these will use web-based tools so
that coders can work from any location and across institutions. We
will also provide scripts for interfacing to mySQL installations,
GitHub and Dataverse as remote servers.

\item {} 
Extension of CIVET to allow the various classification tools
(actions, actors, and location) to automatically be used in coding
forms.

\item {} 
Semi-automatic conversion of the resulting coded data to the
Dataverse format, and more generally integrate the CIVET tools with
the Dataverse metadata, APIs and other tools as well as providing an
access and authorization protocol modeled on the categories used in
Dataverse.

\item {} 
Development of training materials, both text and video, for the
system

\item {} 
We are currently developing this based on a fixed frame that is 960
pixels wide and 700 pixels high: this will fit easily on a 1024x768
screen. For contemporary equipment this is probably quite
conservative but it is not unheard of for data labs to have older
equipment so we’re going with this at the moment

\end{itemize}


\chapter{Appendix 1: Sample Template File}
\label{appendix1:appendix-1-sample-template-file}\label{appendix1::doc}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{} CIVET template demonstration file

h1:Ministry of Magic Hogwarts Incident Report

radio: House where incident occurred: [house]
Gryffindor, Hufflepuff, Ravenclaw, *Slytherin

p:

select:Nature of incident [natincid]
*Minor mischief, Unauthorized absence, Accident, Major infraction, Unforgivable Curses, Other

p:If \PYGZdq{}Other\PYGZdq{}, provide details in the report section

checkbox: Was incident reported to school authorities? [authreport]
No,*Yes

checkbox: Did incident involve muggles? [muggles]
No,Yes

p:

textline: Name of student(s) [names] width=80
Enter names here

p:

textarea:Brief description of incident [descrp] cols = 80
Enter brief description here

p:

textline:Reporting official [reporter] width=40
Enter your name here

h3:Thank you for your assistance; we will contact you by owl should we require more information

save:
\PYGZus{}date\PYGZus{}, house, natincid, authreport, muggles, names, descrp, reporter
\end{Verbatim}

This produces the form
\begin{figure}[htbp]
\centering

\includegraphics{demo_template.png}
\end{figure}


\chapter{Appendix 2: Input Format}
\label{appendix2:appendix-2-input-format}\label{appendix2::doc}
Fields marked with ** are required.


\section{Collection fields}
\label{appendix2:collection-fields}\begin{description}
\item[{collid}] \leavevmode
Collection ID, which needs to be unique within the workspace. If
this is not provided in the file, collfilename is assigned by the
program

\item[{collfilename}] \leavevmode
directory and name of the YAML file (without the suffix) where the
file was read from; this is assigned by the program

\item[{colldate}] \leavevmode
collection date YYYY-MM-DD

\item[{**colledit}] \leavevmode
datetime of editing of this collection  {[}provided by system{]}

\item[{collcmt}] \leavevmode
collection comments

\item[{texts}] \leavevmode
one or more related texts

\item[{cases}] \leavevmode
zero or more coded records

\end{description}


\section{Text fields}
\label{appendix2:text-fields}\begin{description}
\item[{**textid}] \leavevmode
unique text ID for CIVET. This needs to be unique within the
workspace, and given how collections might get mixed across
workspace folders, ideally should be unique for the entire project.
If a value for the \code{text} field is not provided it will be
assigned by the program.

\item[{**textdate}] \leavevmode
text date YYYY-MM-DD

\item[{textpublisher}] \leavevmode
publisher {[}any string{]}

\item[{textpubid}] \leavevmode
publisher ID {[}any string{]}

\item[{textbiblio}] \leavevmode
bibliographic citation

\item[{textgeogloc}] \leavevmode
geographical locations

\item[{textauthorr}] \leavevmode
author {[}any string{]}

\item[{textlang}] \leavevmode
language

\item[{textlicense}] \leavevmode
copyright notification or other license information

\item[{**textlede}] \leavevmode
lede/headline/abstract—this is a short summary of the article
which will be highlighted and also will appear in the sorting
routine.

\item[{textcmt}] \leavevmode
comment

\item[{**textoriginal}] \leavevmode
original text of the story; this will not be modified by the system

\item[{textmkup}] \leavevmode
marked up text: this is the annotated version of the story with
any mark-up that has been added either automatically on manually

\item[{textmkupdate}] \leavevmode
datetime time of editing of this block {[}provided by system{]}

\item[{textmkupcoder}] \leavevmode
coder ID

\end{description}


\section{Case fields}
\label{appendix2:case-fields}\begin{description}
\item[{** caseid}] \leavevmode
Internal case/event ID. This is assigned by the program and
probably should not be changed; external IDs can be entered as
variables.

\item[{** casedate}] \leavevmode
Date and time this case was coded {[}provided by system{]}

\item[{casecmt}] \leavevmode
comment for case

\item[{casecoder}] \leavevmode
coder ID

\item[{casevalues}] \leavevmode
This is a string formatted as a Python dictionary which contains
pairs of variable names and values

\end{description}


\section{Date formats}
\label{appendix2:date-formats}
{[}This has not been consistently implemented in Beta-0.7{]}

Dates are ISO-8601 (\href{http://en.wikipedia.org/wiki/ISO\_8601}{http://en.wikipedia.org/wiki/ISO\_8601};
\href{http://www.w3.org/TR/NOTE-datetime}{http://www.w3.org/TR/NOTE-datetime}; \href{https://xkcd.com/1179/}{https://xkcd.com/1179/};
\href{http://www.cl.cam.ac.uk/mgk25/iso-time.html}{http://www.cl.cam.ac.uk/mgk25/iso-time.html}) so generally either
\begin{itemize}
\item {} 
YYYY-MM-DD

\item {} 
YYYY-MM-DDThh:mm:ss

\item {} 
YYYY-MM-DDThh:mm:ss{[}+-{]}hh:mm

\end{itemize}


\section{Sample File}
\label{appendix2:sample-file}
The following figure shows an example of a simple YAML file; This is a screen capture of a file being edited with \emph{BBEdit},
hence the color mark-up. A workspace demonstration file with several collections can also be downloaded in the program.
\begin{figure}[htbp]
\centering

\includegraphics{yamlexample.png}
\end{figure}


\chapter{Appendix 3: Supporting Files}
\label{appendix3:appendix-3-supporting-files}\label{appendix3::doc}

\section{Files in \texttt{/static/djciv\_data}}
\label{appendix3:files-in-static-djciv-data}

\subsection{Files that can be modified using a text editor}
\label{appendix3:files-that-can-be-modified-using-a-text-editor}\begin{description}
\item[{CIVET.demo.template.txt:}] \leavevmode
Demonstration template file for simple coding

\item[{CIVET.workspace.demo.zip:}] \leavevmode
Demonstration workspace with sample collections, coding form and
user-specified coding categories

\item[{CIVET.stopwords.txt:}] \leavevmode
Stop words for automatic named-entity annotation

\item[{CIVET.numberwords.txt:}] \leavevmode
Number words and phrases for automatic number annotation

\item[{civetstyle.css:}] \leavevmode
Style sheet for some of the program (this is modified with the
user-specified categories)

\end{description}


\subsection{Modify at your own risk}
\label{appendix3:modify-at-your-own-risk}\begin{description}
\item[{ckeditor:}] \leavevmode
This is a \code{ckeditor} file downloaded from
\href{http://ckeditor.com/}{http://ckeditor.com/}: if you would like additional features you
should be able to create your own and swap it in here.

\end{description}


\subsection{CIVET Logo}
\label{appendix3:civet-logo}\begin{description}
\item[{civet\_logo.png:}] \leavevmode
Don’t like our little guy, or want to put your own mascot here?—this
is the place to make the change

\end{description}


\section{Documentation}
\label{appendix3:documentation}
CIVET's documentation is maintained using the Sphinx \href{http://sphinx-doc.org/}{http://sphinx-doc.org/} system.
The files are found in the \code{docs} directory at the outer-most level of the system.
The commands:

\begin{Verbatim}[commandchars=\\\{\}]
make html
make latexpdf
\end{Verbatim}

are used to generate the on-line and PDF documentation; the files are found in the
\code{\textbackslash{}\_build/html} and \code{\textbackslash{}\_build/latex} directories.


\chapter{Appendix 4: Prototype on Google Application Engine}
\label{appendix4:appendix-4-prototype-on-google-application-engine}\label{appendix4::doc}
An earlier demonstration version of the program, written in the Flask
framework, is deployed as an application on the Google App Engine at
\href{http://ace-element-88313.appspot.com/}{http://ace-element-88313.appspot.com/}. The “Coding Form Template” option
in this program works as described {\hyperref[forms:sec-forms]{\emph{\DUspan{}{here}}}}. The code
for this version can be downloaded from \href{https://github.com/philip-schrodt/CIVET-Flask}{https://github.com/philip-schrodt/CIVET-Flask}

The other option in the program is the “Text-Extraction Demonstration
Form” which was a prototype of the full annotation/extraction system. To
activate the demo, from the home page, click the link in the line \emph{See a
demo of the text-highlighting system by clicking here}
\begin{enumerate}
\item {} 
Select a text file to edit: you can use either the pull-down menu or
radio boxes, then click the \code{Edit the file button}.

\item {} 
Click one of the text entry boxes will highlight the relevant words
in text: For demonstration purposes these are words beginning with
the letters ’a’, ’c’, ’d’, ’e’ and ’s’. The ‘tab’ key cycles between
these options, or an option can be selected using the mouse.

\item {} 
When a text entry box is active, the first relevant word in the text
is highlighted. The right-arrow key will cycle the highlighted word.
To copy a highlighted word into the text box, use the down-arrow key.

\item {} 
Text can also be selected using the mouse: To copy the selected text
into the text box, use the left-arrow key.

\item {} 
Cut-and-paste from the text to the date fields work as you would
expect

\item {} 
Text can also be entered manually.

\item {} 
To save a set of coded fields, click one of the buttons along the
bottom.
\begin{description}
\item[{Return to this case:}] \leavevmode
Save, then return to the same text

\item[{Select new case:}] \leavevmode
Save, then return to the same text

\item[{Download data:}] \leavevmode
Save, then download data as a text file

\end{description}

\item {} 
The ``CIVET Download'' page provides a text box for a file name, and
the \code{Download file} button downloads the coded data. Use the \emph{Start
new data file} link to re-start the coding and the \emph{Continue coding
with this file} link to continue adding to the existing records.
\begin{itemize}
\item {} 
The .txt file contains the variable names in the first line.

\item {} 
If the file name does not end in ''.txt'', this will be
added.

\end{itemize}

\item {} 
To quit the program, just close the window: This is a HTML/Javascript security feature which
prevents rogue websites from closing windows unless they have created
the window.

\end{enumerate}


\chapter{Appendix 5: Installing in AWS-EB and Docker}
\label{appendix5:appendix-5-installing-in-aws-eb-and-docker}\label{appendix5::doc}

\section{Amazon Web Services Elastic Beanstalk}
\label{appendix5:amazon-web-services-elastic-beanstalk}
“Cloud” servers are an increasingly popular low-cost alternative to locally-administered servers. A large number of these
options are available; \footnote{
In particular, Heroku (\href{https://www.heroku.com/}{https://www.heroku.com/}) appears to be another
\href{https://devcenter.heroku.com/articles/getting-started-with-django}{Django-friendly} option, and also offers free accounts.
Using Heroku requires a {[}free{]} GitHub account.
} I'm focusing on the Amazon Web Services “Elastic Beanstalk” (AWS-EB) for the simple reason that at the time
of this writing AWS provides a generous free trial option, and their instructions worked the first time I tried. \footnote{
Which, ahem, cannot be said for my multiple attempts to get the system running on the comparable Google service,
though I'm sure it is possible to do this and would be happy to add instructions once someone has figured it
out.
}

A coherent set of instructions can be found at
\href{http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create-deploy-python-django.html}{http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create-deploy-python-django.html}. Then follow these steps:
\begin{enumerate}
\item {} 
Get an AWS account: \href{https://aws.amazon.com/}{https://aws.amazon.com/}

\end{enumerate}

2. In the instructions, skip the steps prior to the
heading \textbf{Configure your Django application for AWS Elastic Beanstalk} unless you also want to try out the system
locally (which is probably a good idea)
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
Download the CIVET system from GitHub: \href{https://github.com/civet-software/CIVET-Django}{https://github.com/civet-software/CIVET-Django} \footnote{
At some point I'll put a “turn-key” directory on GitHub that will have all of the appropriate files. But not yet.
}

\end{enumerate}

4. Create a directory that you will use to deploy the system: for consistency with the remaining instructions it should be
called \emph{AWS-CIVET} though once you are comfortable with these instructions it could be named something different.

5. In that directory, copy the directory \emph{djcivet\_site}. Following the instructions, create directories named \emph{.elasticbeanstalk}
and \emph{.ebextensions} \footnote{
The ‘.’ in front of the file name means these will probably be invisible in most standard views of the \emph{AWS-CIVET}
directory: this is a Unix feature, not a bug.
}
and create a file named \emph{requirements.txt} Just copy the contents from the section below; you don't need the \code{pip freeze}
step. Copy the code in the \textbf{AWS-EB Configuration Files} section below into the various files
\begin{quote}

Your directory will now look like

\begin{Verbatim}[commandchars=\\\{\}]
AWS\PYGZhy{}CIVET
\textbar{}\PYGZhy{}\PYGZhy{} .ebextensions
\textbar{}   {}`\PYGZhy{}\PYGZhy{} 01\PYGZhy{}django\PYGZus{}eb.config
\textbar{}\PYGZhy{}\PYGZhy{} .elasticbeanstalk
\textbar{}   {}`\PYGZhy{}\PYGZhy{} config.yml
\textbar{}\PYGZhy{}\PYGZhy{} djcivet\PYGZus{}site
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} db.sqlite3
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} djcivet\PYGZus{}data
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} docs
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} djcivet\PYGZus{}site
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} settings.py
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} urls.py
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} wsgi.py
\textbar{}   {}`\PYGZhy{}\PYGZhy{} manage.py
{}`\PYGZhy{}\PYGZhy{} requirements.txt
\end{Verbatim}
\end{quote}

6. Install the “eb” command-line tool per the instructions found at
\href{http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3.html}{http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3.html}. Initializing this will require AWS access credentials, a
process described at \href{http://docs.aws.amazon.com/general/latest/gr/getting-aws-sec-creds.html}{http://docs.aws.amazon.com/general/latest/gr/getting-aws-sec-creds.html}.

7. Follow the instructions in the \textbf{Deploy your site using AWS Elastic Beanstalk} section to use “eb” in a terminal
application. It will take a minute or so for the \code{eb create} process to complete—there's plenty of feedback—and there is an
additional lag before the URL will be recognized.

8. You should now see the CIVET home page at the URL \href{http://aws-civet-dev.elasticbeanstalk.com/djciv\_data/}{http://aws-civet-dev.elasticbeanstalk.com/djciv\_data/} Be sure to include
the final “/djciv\_data/'' or you will get an error. Run through the options with the demonstration files to make sure
the site is working. If the site doesn't come up, try reloading a couple of times.

9. When you are finished, enter \code{eb terminate} and respond to the confirmation prompt with “AWS-CIVET-dev” in order to
stop the program.


\subsection{AWS-EB Configuration Files}
\label{appendix5:aws-eb-configuration-files}
In

\begin{Verbatim}[commandchars=\\\{\}]
Django==1.8.3
\end{Verbatim}

In \emph{AWS-CIVET/.elasticbeanstalk/} create the file \emph{config.yml}

\begin{Verbatim}[commandchars=\\\{\}]
branch\PYGZhy{}defaults:
  default:
    environment: AWS\PYGZhy{}CIVET\PYGZhy{}dev
global:
  application\PYGZus{}name: AWS\PYGZus{}CIVET
  default\PYGZus{}ec2\PYGZus{}keyname: aws\PYGZhy{}civet
  default\PYGZus{}platform: Python 2.7
  default\PYGZus{}region: us\PYGZhy{}east\PYGZhy{}1
  profile: eb\PYGZhy{}cli
  sc: null
\end{Verbatim}

In \emph{AWS\_CIVET/.ebextensions/} create the file \emph{01-djcivet\_site.config}

\begin{Verbatim}[commandchars=\\\{\}]
container\PYGZus{}commands:
    01\PYGZus{}collectstatic:
      command: \PYGZdq{}source /opt/python/run/venv/bin/activate \PYGZam{}\PYGZam{} python djcivet\PYGZus{}site/manage.py collectstatic \PYGZhy{}\PYGZhy{}noinput\PYGZdq{}

option\PYGZus{}settings:
  \PYGZdq{}aws:elasticbeanstalk:application:environment\PYGZdq{}:
    DJANGO\PYGZus{}SETTINGS\PYGZus{}MODULE: \PYGZdq{}djcivet\PYGZus{}site.settings\PYGZdq{}
    PYTHONPATH: \PYGZdq{}/opt/python/current/app/djcivet\PYGZus{}site:\PYGZdl{}PYTHONPATH\PYGZdq{}
  \PYGZdq{}aws:elasticbeanstalk:container:python\PYGZdq{}:
    WSGIPath: \PYGZdq{}djcivet\PYGZus{}site/djcivet\PYGZus{}site/wsgi.py\PYGZdq{}
\end{Verbatim}

In \emph{djcivet\_site/djcivet\_site/settings.py}
\begin{itemize}
\item {} 
Set \code{DEBUG = False}

\item {} 
Change SECRET\_KEY since the downloaded version isn't exactly secret

\end{itemize}


\subsection{Handling of \emph{static} files}
\label{appendix5:handling-of-static-files}
As even a brief perusal of the web will affirm, the handling of \emph{static} files in production versions of
Django is, well, complicated. After joining legions of programmers past, present and future in beating my head against
the wall on trying to get CIVET to access files internally in production as it does in the development mode, I gave up \footnote{
Or simply took the approach that the Django system clearly prefers, depending on your perspective
}
and put the static resources referenced from inside templates on a directory on an external server, specifically
\emph{http://civet.parusanalytics.com/civet\_static/}  Files that are read in \emph{views.py} remain in the \emph{static/djciv\_data}
folder, which works in both the development and production modes.

If you would like to modify the static files in the system—the main target would be \emph{CKEditor}, unless you find our
mascot too insufferably cute—you can move this material (the contents of the directory \emph{static/djciv\_data} in the distribution) to
the server of your choice: just change the address in \code{settings.STATIC\_SOURCE} to point to the new location. \footnote{
An apparently popular approach for handling this is to use an AWS S3 server instance for external storage of static files:
there are multiple descriptions on the Web describing how to do this. As it involves quite a few steps and I've
got a perfectly good server already set up in the cloud, I went with that route instead.
}


\section{Docker}
\label{appendix5:docker}
Docker (\href{https://www.docker.com/}{https://www.docker.com/}) is a highly popular, rapidly evolving \footnote{
Which is to say, a whole lot of moving parts which don't quite always play well together and inconsistently documented:
see   \href{http://blog.circleci.com/its-the-future/}{http://blog.circleci.com/its-the-future/},
\href{http://blog.circleci.com/it-really-is-the-future/}{http://blog.circleci.com/it-really-is-the-future/}, and \href{https://valdhaus.co/writings/docker-misconceptions/}{https://valdhaus.co/writings/docker-misconceptions/} \footnote{
Thanks to John Beieler for the links.
}
} “containerization” system which will ultimately simplify the secure deployment
of software in a wide variety of different systems. Briefly, “containers” are a more efficient extension of the concept of
\href{https://en.wikipedia.org/wiki/Virtual\_machine}{virtual machines} —computers running programs which simulate the operation
of other computers—by packaging all of the required software in an “image” file that is able to run on any system capable of
running Docker. Because the operations within a container can be isolated from the host machine, and the contents of the
container can be inspected and verified, this should provide a more secure (and efficient) environment than situations where
a variety of software
needs to be installed in order for a system to run, and that software potentially has access to all of the resources of the system. \footnote{
Or as the situation was recently explicated at our local software development meet-up, in reference
to a certain institution that does not have a campus but “Grounds”, and I am not referring to Starbucks, “So which
is it with your sysadmins? They want to make sure Docker is deployed securely? Well, there are plenty of ways to do
that. Or they just don't want to do any work? Then you've got a different set of problems.”
}
Hence the excitement.

To date, I have successfully gotten the Docker container described below to run CIVET in development mode as a container on my
Macintosh; I attempted to get it running on the Google Cloud but was unsuccessful; I have not tried any other configurations.
As always, I will be happy to incorporate any additional suggestions into this documentation.

The guide I used for the deployment is \href{http://michal.karzynski.pl/blog/2015/04/19/packaging-django-applications-as-docker-container-images/}{http://michal.karzynski.pl/blog/2015/04/19/packaging-django-applications-as-docker-container-images/}.
This was not the first one I tried, and as indicated above, Docker is still evolving
so you should make certain you are using a recent set of guides (and the instructions here may break sooner rather than
later.)

Using Karzynski as a guide, here are the steps:

1. If you aren't already using Docker, get a Docker account—there is a free option—and install Docker: the instructions for
this will vary depending on your operating system; Karzynski's instructions are just for Linux.

2. Set-up a directory to hold the Docker project---I called this \emph{Docker-CIVET}, which corresponds to Karzynski's local
directory \emph{dockyard}. I'll be using Karzynski's Docker image name DOCKYARD.
\begin{enumerate}
\setcounter{enumi}{2}
\item {} 
Copy the directory \emph{djcivet\_site} into \emph{Docker-CIVET}.

\end{enumerate}

4. In \emph{Docker-CIVET}, create the \emph{docker-entrypoint.sh} and \emph{Dockerfile} files from the code given below. Your directory
will now look like
\begin{quote}

\begin{Verbatim}[commandchars=\\\{\}]
Docker\PYGZhy{}CIVET
\textbar{}\PYGZhy{}\PYGZhy{} docker\PYGZhy{}entrypoint.sh
\textbar{}\PYGZhy{}\PYGZhy{} Dockerfile
\textbar{}\PYGZhy{}\PYGZhy{} djcivet\PYGZus{}site
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} db.sqlite3
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} djcivet\PYGZus{}data
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} docs
\textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} djcivet\PYGZus{}site
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} \PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}.py
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} settings.py
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} urls.py
\textbar{}   \textbar{}   \textbar{}\PYGZhy{}\PYGZhy{} wsgi.py
\textbar{}   {}`\PYGZhy{}\PYGZhy{} manage.py
{}`\PYGZhy{}\PYGZhy{} requirements.txt
\end{Verbatim}
\end{quote}

5. Follow the remaining instructions to build and test the container with the \code{user-name} from your Docker account and the
\code{image-name} of your choice (e.g. \code{docker-civet}).


\subsection{Contents of \emph{docker-entrypoint.sh}}
\label{appendix5:contents-of-docker-entrypoint-sh}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{}!/bin/bash
python manage.py migrate                  \PYGZsh{} Apply database migrations
python manage.py collectstatic \PYGZhy{}\PYGZhy{}noinput  \PYGZsh{} Collect static files

\PYGZsh{} Prepare log files and start outputting logs to stdout
touch /srv/logs/gunicorn.log
touch /srv/logs/access.log
tail \PYGZhy{}n 0 \PYGZhy{}f /srv/logs/*.log \PYGZam{}

\PYGZsh{} Start Gunicorn processes
echo Starting Gunicorn.
exec gunicorn djcivet\PYGZus{}site.wsgi:application \PYGZbs{}
    \PYGZhy{}\PYGZhy{}name djcivet\PYGZus{}site \PYGZbs{}
    \PYGZhy{}\PYGZhy{}bind 0.0.0.0:8000 \PYGZbs{}
    \PYGZhy{}\PYGZhy{}workers 3 \PYGZbs{}
    \PYGZhy{}\PYGZhy{}log\PYGZhy{}level=info \PYGZbs{}
    \PYGZhy{}\PYGZhy{}log\PYGZhy{}file=/srv/logs/gunicorn.log \PYGZbs{}
    \PYGZhy{}\PYGZhy{}access\PYGZhy{}logfile=/srv/logs/access.log \PYGZbs{}
    \PYGZdq{}\PYGZdl{}@\PYGZdq{}
\end{Verbatim}


\subsection{Contents of \emph{Dockerfile}}
\label{appendix5:contents-of-dockerfile}
\begin{Verbatim}[commandchars=\\\{\}]
\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}
\PYGZsh{} Dockerfile to run a Django\PYGZhy{}based web application
\PYGZsh{} Based on an Ubuntu Image
\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}\PYGZsh{}

\PYGZsh{} Set the base image to use to Ubuntu
FROM ubuntu:14.04

\PYGZsh{} Set the file maintainer (your name \PYGZhy{} the file\PYGZsq{}s author)
MAINTAINER Parus Analytics

\PYGZsh{} Set env variables used in this Dockerfile (add a unique prefix, such as DOCKYARD)
\PYGZsh{} Local directory with project source
ENV DOCKYARD\PYGZus{}SRC=djcivet\PYGZus{}site
\PYGZsh{} Directory in container for all project files
ENV DOCKYARD\PYGZus{}SRVHOME=/srv
\PYGZsh{} Directory in container for project source files
ENV DOCKYARD\PYGZus{}SRVPROJ=/srv/djcivet\PYGZus{}site

\PYGZsh{} Update the default application repository sources list
RUN apt\PYGZhy{}get update \PYGZam{}\PYGZam{} apt\PYGZhy{}get \PYGZhy{}y upgrade
RUN apt\PYGZhy{}get install \PYGZhy{}y python python\PYGZhy{}pip

\PYGZsh{} Create application subdirectories
WORKDIR \PYGZdl{}DOCKYARD\PYGZus{}SRVHOME
RUN mkdir media static logs
VOLUME [\PYGZdq{}\PYGZdl{}DOCKYARD\PYGZus{}SRVHOME/media/\PYGZdq{}, \PYGZdq{}\PYGZdl{}DOCKYARD\PYGZus{}SRVHOME/logs/\PYGZdq{}]

\PYGZsh{} Copy application source code to SRCDIR
COPY \PYGZdl{}DOCKYARD\PYGZus{}SRC \PYGZdl{}DOCKYARD\PYGZus{}SRVPROJ

\PYGZsh{} Install Python dependencies
\PYGZsh{}RUN pip install \PYGZhy{}r \PYGZdl{}DOCKYARD\PYGZus{}SRVPROJ/requirements.txt
RUN pip install Django
RUN pip install gunicorn
\PYGZsh{} Port to expose
EXPOSE 8000

\PYGZsh{} Copy entrypoint script into the image
WORKDIR \PYGZdl{}DOCKYARD\PYGZus{}SRVPROJ
COPY ./docker\PYGZhy{}entrypoint.sh /
ENTRYPOINT [\PYGZdq{}/docker\PYGZhy{}entrypoint.sh\PYGZdq{}]
\end{Verbatim}



\renewcommand{\indexname}{Index}
\printindex
\end{document}
